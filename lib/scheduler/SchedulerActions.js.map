{"version":3,"sources":["../../es6/scheduler/SchedulerActions.js"],"names":[],"mappings":"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","file":"dist/es6/scheduler/SchedulerActions.js","sourcesContent":["import SerialSubscription from '../SerialSubscription';\nimport Immediate from '../util/Immediate';\nimport Subscription from '../Subscription';\nexport class ScheduledAction extends SerialSubscription {\n    constructor(scheduler, state, work) {\n        super(null);\n        this.scheduler = scheduler;\n        this.work = work;\n        this.state = state;\n    }\n    schedule() {\n        var scheduler = this.scheduler;\n        var actions = scheduler.actions;\n        actions.push(this);\n        scheduler.flush();\n        return this;\n    }\n    execute() {\n        if (this.unsubscribed) {\n            throw new Error(\"How did did we execute a canceled ScheduledAction?\");\n        }\n        this.add(Subscription.from(this.work(this.state), this.observer));\n    }\n    unsubscribe() {\n        super.unsubscribe();\n        var actions = this.scheduler.actions;\n        var index = Array.isArray(actions) ? actions.indexOf(this) : -1;\n        if (index !== -1) {\n            actions.splice(index, 1);\n        }\n        this.work = void 0;\n        this.state = void 0;\n        this.scheduler = void 0;\n    }\n}\nexport class NextScheduledAction extends ScheduledAction {\n    schedule() {\n        var self = this;\n        var scheduler = this.scheduler;\n        scheduler.actions.push(this);\n        if (!scheduler.scheduled) {\n            scheduler.active = true;\n            scheduler.scheduled = true;\n            this.id = Immediate.setImmediate(function () {\n                self.id = void 0;\n                scheduler.active = false;\n                scheduler.scheduled = false;\n                scheduler.flush();\n            });\n        }\n        return this;\n    }\n    unsubscribe() {\n        var scheduler = this.scheduler;\n        if (scheduler.actions.length === 0) {\n            scheduler.active = false;\n            scheduler.scheduled = false;\n            var id = this.id;\n            if (id) {\n                this.id = void 0;\n                Immediate.clearImmediate(id);\n            }\n        }\n        super.unsubscribe();\n    }\n}\nexport class FutureScheduledAction extends ScheduledAction {\n    constructor(scheduler, state, work, delay) {\n        super(scheduler, state, work);\n        this.delay = delay;\n    }\n    schedule() {\n        var self = this;\n        var id = this.id;\n        var scheduler = this.scheduler;\n        if (id != null) {\n            this.id = undefined;\n            clearTimeout(id);\n        }\n        var scheduleAction = super.schedule;\n        this.id = setTimeout(function executeFutureAction() {\n            self.id = void 0;\n            scheduleAction.call(self, self.state);\n        }, this.delay);\n        return this;\n    }\n    unsubscribe() {\n        var id = this.id;\n        if (id != null) {\n            this.id = void 0;\n            clearTimeout(id);\n        }\n        super.unsubscribe();\n    }\n}\n"]}