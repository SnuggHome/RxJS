{"version":3,"sources":["../../es6/operator/mergeAll.js"],"names":[],"mappings":"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","file":"dist/es6/operator/mergeAll.js","sourcesContent":["import Observer from '../Observer';\nimport Subscription from '../Subscription';\nimport SerialSubscription from '../SerialSubscription';\nimport CompositeSubscription from '../CompositeSubscription';\nimport Observable from '../Observable';\nimport $$observer from '../util/Symbol_observer';\nclass MergeAllObserver extends Observer {\n    constructor(destination, concurrent) {\n        super(destination);\n        this.stopped = false;\n        this.buffer = [];\n        this.concurrent = concurrent;\n        this.subscriptions = new CompositeSubscription();\n    }\n    next(observable) {\n        var buffer = this.buffer;\n        var concurrent = this.concurrent;\n        var subscriptions = this.subscriptions;\n        if (subscriptions.length < concurrent) {\n            var innerSubscription = new SerialSubscription(null);\n            var innerObserver = new MergeInnerObserver(this, innerSubscription);\n            subscriptions.add(innerSubscription);\n            innerSubscription.add(observable[$$observer](innerObserver));\n        }\n        else if (buffer) {\n            buffer.push(observable);\n        }\n        return { done: false };\n    }\n    return() {\n        this.stopped = true;\n        if (this.subscriptions.length === 0 && (this.buffer && this.buffer.length === 0)) {\n            this.destination.return();\n        }\n        return { done: true };\n    }\n    _innerReturn(innerObserver) {\n        var buffer = this.buffer;\n        var subscriptions = this.subscriptions;\n        subscriptions.remove(innerObserver.subscription);\n        if (subscriptions.length < this.concurrent) {\n            if (buffer && buffer.length > 0) {\n                this.next(buffer.shift());\n            }\n            else if (this.stopped && subscriptions.length === 0) {\n                return this.destination.return();\n            }\n        }\n        return { done: true };\n    }\n    _dispose() {\n        console.log('dispose parent');\n        this.subscriptions.unsubscribe();\n    }\n}\nclass MergeInnerObserver extends Observer {\n    constructor(parent, subscription) {\n        super(parent.destination);\n        this.parent = parent;\n        this.subscription = subscription;\n    }\n    _return() {\n        return this.parent._innerReturn(this);\n    }\n}\nclass MergeAllObservable extends Observable {\n    constructor(source, concurrent) {\n        super(null);\n        this.source = source;\n        this.concurrent = concurrent;\n    }\n    subscriber(observer) {\n        var mergeAllObserver = new MergeAllObserver(observer, this.concurrent);\n        return Subscription.from(this.source.subscriber(mergeAllObserver), mergeAllObserver);\n    }\n}\nexport default function mergeAll(concurrent = Number.POSITIVE_INFINITY) {\n    return new MergeAllObservable(this, concurrent);\n}\n;\n"]}